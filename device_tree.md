# Device Tree
## U-Boot
https://u-boot.readthedocs.io/en/latest/usage/fit/howto.html
## FIT
Flattened Image Tree

FIT is formally a flattened devicetree.


## .its
image tree source  
### milkv-duo  
https://github.com/RT-Thread/rt-thread/blob/master/bsp/cv1800b/multi.its

## .itb
flattened image tree blob  
### milkv-duo 
**_boot.sd_** is a itb file in boot partion of milkv-duo's image.  
Required by milk-v U-boot, simple kernel image won't work.

## kernel

https://docs.kernel.org/devicetree/usage-model.html  
## .dts
Device Tree Source  
location in kernel source: `arch/<your_device_arch>/boot/dts`

## .dtb
Device Tree Blob, also named FDT (Flattened Device Tree)  
Compiled from .dts and .dtsi, may even include .h file.  
Can be built in u-boot or kernel, or even use device tree compiler only.  
https://elinux.org/Device_Tree_Reference#Tools_in_Linux_kernel_source_tree

### milkv-duo
dts, dtsi and .h are currently _not_ in the kernel tree but several bulid folders in SDK. **Unusual**.  
- [dts_riscv](https://github.com/milkv-duo/duo-buildroot-sdk/tree/develop/build/boards/cv180x/cv1800b_milkv_duo_sd/dts_riscv)
- [dts/cv180x](https://github.com/milkv-duo/duo-buildroot-sdk/tree/develop/build/boards/default/dts/cv180x  )
- [cv180x_riscv](https://github.com/milkv-duo/duo-buildroot-sdk/tree/develop/build/boards/default/dts/cv180x_riscv)

## cvi_board_memmap.h
[cv180x_base_riscv.dtsi line 7](https://github.com/milkv-duo/duo-buildroot-sdk/blob/31e0608f0d265a9a0826b0603234a78675490fa2/build/boards/default/dts/cv180x_riscv/cv180x_base_riscv.dtsi#L7C1-L7C30)

This header specifies the memmap layout of milkv-duo and is included by cv180x_base_riscv.dtsi. Can be generated by the following command:  
`duo-buildroot-sdk/build/scripts/mmap_conv.py --type h duo-buildroot-sdk/build/boards/cv180x/cv1800b_milkv_duo_sd/memmap.py cvi_board_memmap.h`


built cv1800b_milkv_duo_sd.dtb: 
https://github.com/RT-Thread/rt-thread/blob/master/bsp/cv1800b/cv1800b_milkv_duo_sd.dtb  

## My modified dev kernel commit
https://github.com/xyq1113723547/cvitek-linux-5.10/commit/15ea08f842174c4eff8dcc0943de6e70b0b7aa2f

## Yocto

https://git.yoctoproject.org/poky/plain/meta/classes-recipe/kernel-fitimage.bbclass  
Generates .its and .dtb from its internal scripts automatically.  
FIT image is also auto generated, but the final .itb renamed to boot.sd is not compatible with u-boot in milkv-duo.  
Attempting to override configuration.
